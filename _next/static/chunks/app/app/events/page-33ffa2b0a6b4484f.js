(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[462],{285:(e,t,a)=>{"use strict";a.d(t,{$:()=>d,r:()=>i});var n=a(5155);a(2115);var r=a(9708),s=a(2085),l=a(9434);let i=(0,s.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function d(e){let{className:t,variant:a,size:s,asChild:d=!1,...c}=e,o=d?r.DX:"button";return(0,n.jsx)(o,{"data-slot":"button",className:(0,l.cn)(i({variant:a,size:s,className:t})),...c})}},310:(e,t,a)=>{Promise.resolve().then(a.bind(a,5430))},2409:(e,t,a)=>{"use strict";a.d(t,{U:()=>r});var n=a(3865);function r(){return(0,n.createBrowserClient)("https://aekfivlrnrdzolsiipdf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFla2ZpdmxybnJkem9sc2lpcGRmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAxNDU4NjksImV4cCI6MjA2NTcyMTg2OX0.yIkqGYpn_xqDYlLOAmmsW2zkHLR3mTOTG7lpYHktvyU")}},2523:(e,t,a)=>{"use strict";a.d(t,{p:()=>l});var n=a(5155),r=a(2115),s=a(9434);let l=r.forwardRef((e,t)=>{let{className:a,type:r,...l}=e;return(0,n.jsx)("input",{type:r,className:(0,s.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...l})});l.displayName="Input"},5057:(e,t,a)=>{"use strict";a.d(t,{J:()=>c});var n=a(5155),r=a(2115),s=a(968),l=a(2085),i=a(9434);let d=(0,l.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(s.b,{ref:t,className:(0,i.cn)(d(),a),...r})});c.displayName=s.b.displayName},5430:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>em,dynamic:()=>eh});var n=a(5155),r=a(2409),s=a(2115),l=a(5695),i=a(6695),d=a(3717),c=a(2525),o=a(9074),u=a(3332),h=a(9145),m=a(285);function x(e){let{event:t,view:a,onEdit:r,onDelete:s}=e;return"list"===a?(0,n.jsxs)("div",{className:"flex items-center justify-between border rounded-lg p-4 bg-card hover:bg-accent/50 transition-colors duration-200 shadow-sm hover:shadow-md",children:[(0,n.jsxs)("div",{className:"flex flex-col flex-1 min-w-0",children:[(0,n.jsx)("p",{className:"font-medium text-sm mb-1 truncate",children:t.title}),(0,n.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Ng\xe0y ",t.lunarDay,"/",t.lunarMonth," \xc2m lịch",t.isLeapMonth&&" (nhuận)"]})]}),(0,n.jsxs)("div",{className:"flex gap-2 ml-4 flex-shrink-0",children:[(0,n.jsxs)(m.$,{variant:"outline",size:"sm",onClick:()=>null==r?void 0:r(t),className:"text-amber-600 border-amber-200 hover:bg-amber-50 hover:border-amber-300",children:[(0,n.jsx)(d.A,{className:"h-4 w-4 mr-1"}),"Sửa"]}),(0,n.jsxs)(m.$,{variant:"outline",size:"sm",onClick:()=>null==s?void 0:s(t),className:"text-red-600 border-red-200 hover:bg-red-50 hover:border-red-300",children:[(0,n.jsx)(c.A,{className:"h-4 w-4 mr-1"}),"X\xf3a"]})]})]}):(0,n.jsxs)(i.Zp,{className:"hover:shadow-lg transition-all duration-200 border hover:border-border",children:[(0,n.jsxs)(i.aR,{className:"pb-4",children:[(0,n.jsx)(i.ZB,{className:"text-lg font-semibold text-foreground",children:t.title}),t.description&&(0,n.jsx)("p",{className:"text-sm text-muted-foreground pt-1",children:t.description})]}),(0,n.jsxs)(i.Wu,{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[(0,n.jsx)(o.A,{className:"h-4 w-4 text-red-500"}),(0,n.jsxs)("span",{children:["Ng\xe0y ",t.lunarDay,"/",t.lunarMonth," \xc2m lịch",t.isLeapMonth&&" (nhuận)"]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,n.jsx)(u.A,{className:"h-4 w-4 text-sky-500"}),(0,n.jsx)("span",{className:"bg-sky-100 text-sky-800 dark:bg-sky-900/20 dark:text-sky-300 px-2 py-1 rounded-full text-xs font-medium",children:"H\xe0ng năm"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,n.jsx)(h.A,{className:"h-4 w-4 text-green-500"}),(0,n.jsx)("span",{className:"text-green-700 dark:text-green-400 font-medium",children:"Lịch \xc2m"})]})]}),(0,n.jsxs)("div",{className:"pt-3 border-t flex gap-2",children:[(0,n.jsxs)(m.$,{variant:"outline",size:"sm",onClick:()=>null==r?void 0:r(t),className:"flex-1 text-amber-600 border-amber-200 hover:bg-amber-50 hover:border-amber-300",children:[(0,n.jsx)(d.A,{className:"h-4 w-4 mr-2"}),"Sửa"]}),(0,n.jsxs)(m.$,{variant:"outline",size:"sm",onClick:()=>null==s?void 0:s(t),className:"flex-1 text-red-600 border-red-200 hover:bg-red-50 hover:border-red-300",children:[(0,n.jsx)(c.A,{className:"h-4 w-4 mr-2"}),"X\xf3a"]})]})]})]})}var g=a(4541),p=a(5968),y=a(9434);function f(e){let{events:t,onEdit:a,onDelete:r}=e,[l,i]=(0,s.useState)("grid");return(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"flex justify-end mb-4",children:(0,n.jsxs)("div",{className:"inline-flex items-center rounded-md bg-gray-100 dark:bg-gray-800 p-1",children:[(0,n.jsx)(m.$,{variant:"ghost",size:"sm",onClick:()=>i("grid"),className:(0,y.cn)("px-3 py-1 hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50","grid"===l&&"bg-white dark:bg-gray-700 shadow text-foreground"),children:(0,n.jsx)(g.A,{className:"h-4 w-4"})}),(0,n.jsx)(m.$,{variant:"ghost",size:"sm",onClick:()=>i("list"),className:(0,y.cn)("px-3 py-1 hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50","list"===l&&"bg-white dark:bg-gray-700 shadow text-foreground"),children:(0,n.jsx)(p.A,{className:"h-4 w-4"})})]})}),(0,n.jsx)("div",{className:(0,y.cn)("transition-all duration-300","grid"===l?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6":"space-y-4"),children:t.map(e=>(0,n.jsx)(x,{event:e,view:l,onEdit:a,onDelete:r},e.id))})]})}var v=a(4616),b=a(1284),j=a(1201),N=a(8767),k=a(5163),w=a(9103),D=a(2138);let L=[{id:"death-anniversary",name:"Ng\xe0y giỗ",description:"Nhắc nhở ng\xe0y giỗ h\xe0ng năm",longDescription:"ℹ️ Mẫu phổ biến nhất - Tự động tạo nhắc nhở cho ng\xe0y giỗ theo truyền thống Việt Nam, lặp lại h\xe0ng năm theo ng\xe0y \xe2m.\nℹ️ Nhắc trước 3 ng\xe0y (nhắc lại h\xe0ng năm).\nℹ️ Nhắc trước 1 ng\xe0y (nhắc lại h\xe0ng năm).",icon:j.A,isLunar:!0,repeatYearly:!0,notifySettings:[{advanceDays:3,note:"C\xf2n 3 ng\xe0y nữa l\xe0 ng\xe0y giỗ của [T\xean người giỗ]",isYearlyLunarRepeat:!0},{advanceDays:1,note:"Ng\xe0y mai l\xe0 ng\xe0y giỗ của [T\xean người giỗ]",isYearlyLunarRepeat:!0}]},{id:"funeral",name:"Tang lễ",description:"Bao gồm nhắc nhở c\xe1c lễ c\xfang cơm truyền thống t\xednh theo ng\xe0y mất: 7, 49, 100 ng\xe0y v\xe0 ng\xe0y giỗ h\xe0ng năm",longDescription:"ℹ️ Mẫu tự động tạo nhắc nhở cho c\xe1c lễ c\xfang cơm truyền thống t\xednh theo ng\xe0y mất (m\xe0 bạn sẽ chọn): 7, 49, 100 ng\xe0y (chưa trừ theo số ng\xe0y nhắc trước bạn sẽ chọn).\nℹ️ T\xf9y theo địa phương v\xe0 truyền thống gia đ\xecnh, c\xe1c bạn c\xf3 thể tạo th\xeam c\xe1c nhắc nhở ph\xf9 hợp nh\xe9.\nℹ️ Nhắc nhở lễ c\xfang 7 ng\xe0y, 49 ng\xe0y, 100 ng\xe0y (kh\xf4ng nhắc lại) - nhắc trước 1 ng\xe0y.\nℹ️ Nhắc nhở lễ ng\xe0y giỗ (nhắc lại h\xe0ng năm) - nhắc trước 1 ng\xe0y.",icon:N.A,isLunar:!0,setDateToToday:!1,repeatYearly:!1,notifySettings:[{advanceDays:-6,note:"Ng\xe0y mai l\xe0 lễ c\xfang 7 ng\xe0y",isYearlyLunarRepeat:!1},{advanceDays:-48,note:"Ng\xe0y mai l\xe0 lễ c\xfang 49 ng\xe0y",isYearlyLunarRepeat:!1},{advanceDays:-99,note:"Ng\xe0y mai l\xe0 lễ c\xfang 100 ng\xe0y (Tốt khốc)",isYearlyLunarRepeat:!1},{advanceDays:1,note:"Ng\xe0y mai l\xe0 ng\xe0y giỗ của [T\xean người giỗ]",isYearlyLunarRepeat:!0}]},{id:"newborn",name:"Em b\xe9 ch\xe0o đời",description:"Theo d\xf5i từ sinh → đầy th\xe1ng → sinh nhật đầu ti\xean",longDescription:"ℹ️ Mẫu tự động tạo nhắc nhở cho ng\xe0y đầy th\xe1ng v\xe0 th\xf4i n\xf4i cho em b\xe9 vừa sinh ra theo truyền thống Việt Nam.\nℹ️ Nhắc nhở đầy th\xe1ng (kh\xf4ng nhắc lại).\nℹ️ Nhắc nhở th\xf4i n\xf4i (kh\xf4ng nhắc lại).\n⚠️ Lưu \xfd về đầy th\xe1ng cho b\xe9 trai v\xe0 b\xe9 g\xe1i, t\xf9y theo địa phương v\xe0 theo phong tục truyền thống: mẫu sẽ tạo nhắc nhở đầy th\xe1ng cho b\xe9 sau sinh 30 ng\xe0y, bạn tự điều chỉnh để ph\xf9 hợp nhu cầu nh\xe9.",icon:k.A,isLunar:!1,setDateToToday:!0,repeatYearly:!0,notifySettings:[{advanceDays:29,note:"Ng\xe0y mai l\xe0 ng\xe0y đầy th\xe1ng của b\xe9 [T\xean b\xe9]",isYearlyLunarRepeat:!1},{advanceDays:1,note:"Ng\xe0y mai l\xe0 th\xf4i n\xf4i của b\xe9 [T\xean b\xe9]",isYearlyLunarRepeat:!0}]}];function _(e){let{isOpen:t,onClose:a,onSelect:r}=e,[l,d]=(0,s.useState)(L[0]),[c,o]=(0,s.useState)(!1);if(!t)return null;let u=e=>{d(e),o(!1)};return(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",onClick:a,children:(0,n.jsxs)(i.Zp,{className:"rounded-lg shadow-xl w-full max-w-6xl max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)(i.aR,{children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)(i.ZB,{className:"flex items-center gap-3 text-2xl text-green-800 dark:text-green-500",children:[(0,n.jsx)(w.A,{className:"h-8 w-8 text-green-600 dark:text-green-400"}),(0,n.jsx)("span",{children:"Chọn loại sự kiện"})]}),(0,n.jsx)("button",{onClick:a,className:"text-muted-foreground hover:text-foreground p-1 rounded-full hover:bg-accent",children:"✕"})]}),(0,n.jsx)(i.BT,{className:"mt-2",children:"Bắt đầu nhanh hơn bằng c\xe1ch chọn một mẫu c\xf3 sẵn."}),(0,n.jsxs)("div",{className:"mt-4 flex items-center justify-center gap-2",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full bg-green-500"}),(0,n.jsx)("div",{className:"w-8 h-1 bg-gray-300 dark:bg-gray-600"}),(0,n.jsx)("div",{className:"w-3 h-3 rounded-full bg-gray-300 dark:bg-gray-600"}),(0,n.jsx)("div",{className:"w-8 h-1 bg-gray-300 dark:bg-gray-600"}),(0,n.jsx)("div",{className:"w-3 h-3 rounded-full bg-gray-300 dark:bg-gray-600"}),(0,n.jsx)("div",{className:"text-xs text-muted-foreground ml-2",children:"Bước 1/3: Chọn template"})]})]}),(0,n.jsxs)(i.Wu,{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[L.map(e=>(0,n.jsxs)("div",{className:"border rounded-lg p-4 flex flex-col items-center justify-center text-center cursor-pointer transition-colors min-h-[160px] ".concat((null==l?void 0:l.id)===e.id?"border-primary bg-primary/5":"hover:bg-accent"),onClick:()=>u(e),children:[(0,n.jsx)(e.icon,{className:"h-10 w-10 text-primary mb-2"}),(0,n.jsx)("h3",{className:"font-semibold text-base leading-tight",children:e.name}),(0,n.jsx)("p",{className:"text-xs text-muted-foreground mt-2 leading-tight",children:e.description})]},e.id)),(0,n.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-4 flex flex-col items-center justify-center text-center cursor-pointer transition-colors min-h-[160px] ".concat(c?"border-primary bg-primary/5":"border-primary/50 hover:bg-accent"),onClick:()=>{d(null),o(!0)},children:[(0,n.jsx)(w.A,{className:"h-10 w-10 text-primary mb-2"}),(0,n.jsx)("h3",{className:"font-semibold text-base leading-tight",children:"Tạo sự kiện t\xf9y chỉnh"}),(0,n.jsx)("p",{className:"text-xs text-muted-foreground mt-2 leading-tight",children:"Bắt đầu với một form trống để tự thiết kế sự kiện."})]})]}),l&&(0,n.jsxs)("div",{className:"border rounded-lg p-6 bg-muted/30",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,n.jsx)(l.icon,{className:"h-6 w-6 text-primary"}),(0,n.jsx)("h4",{className:"font-semibold text-lg",children:l.name})]}),(0,n.jsx)("p",{className:"text-muted-foreground leading-relaxed whitespace-pre-wrap",children:l.longDescription})]}),c&&(0,n.jsxs)("div",{className:"border rounded-lg p-6 bg-muted/30",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,n.jsx)(w.A,{className:"h-6 w-6 text-primary"}),(0,n.jsx)("h4",{className:"font-semibold text-lg",children:"Tạo sự kiện t\xf9y chỉnh"})]}),(0,n.jsx)("p",{className:"text-muted-foreground leading-relaxed whitespace-pre-wrap",children:"Bạn sẽ được đưa đến form tạo sự kiện trống, nơi bạn c\xf3 thể tự do thiết kế sự kiện theo \xfd muốn với c\xe1c th\xf4ng tin như t\xean sự kiện, ng\xe0y th\xe1ng, v\xe0 c\xe0i đặt th\xf4ng b\xe1o ho\xe0n to\xe0n t\xf9y chỉnh."})]}),(0,n.jsxs)("div",{className:"flex justify-between pt-4",children:[(0,n.jsx)(m.$,{variant:"outline",onClick:a,children:"Hủy bỏ"}),(0,n.jsxs)(m.$,{onClick:()=>{l?r(l):c&&r(null)},disabled:!l&&!c,className:"flex items-center gap-2",children:["Tiếp theo",(0,n.jsx)(D.A,{className:"h-4 w-4"})]})]})]})]})})}var C=a(6681),S=a(7550),M=a(2523),T=a(5057),A=a(7),Y=a(8738),F=a(3068),z=a(3509),R=a(2098),E=a(2967),I=a(5933),B=a(2355),G=a(3052),J=a(6474),q=a(713),O=a(5003);function P(){let e=(0,I._)(["rtl:**:[.rdp-button_next>svg]:rotate-180"],["rtl:**:[.rdp-button\\_next>svg]:rotate-180"]);return P=function(){return e},e}function $(){let e=(0,I._)(["rtl:**:[.rdp-button_previous>svg]:rotate-180"],["rtl:**:[.rdp-button\\_previous>svg]:rotate-180"]);return $=function(){return e},e}function V(e){let{className:t,classNames:a,showOutsideDays:r=!0,captionLayout:s="label",buttonVariant:l="ghost",formatters:i,components:d,...c}=e,o=(0,q.a)();return(0,n.jsx)(O.h,{showOutsideDays:r,className:(0,y.cn)("bg-background group/calendar p-3 [--cell-size:--spacing(8)] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent",String.raw(P()),String.raw($()),t),captionLayout:s,formatters:{formatMonthDropdown:e=>e.toLocaleString("default",{month:"short"}),...i},classNames:{root:(0,y.cn)("w-fit",o.root),months:(0,y.cn)("flex gap-4 flex-col md:flex-row relative",o.months),month:(0,y.cn)("flex flex-col w-full gap-4",o.month),nav:(0,y.cn)("flex items-center gap-1 w-full absolute top-0 inset-x-0 justify-between",o.nav),button_previous:(0,y.cn)((0,m.r)({variant:l}),"size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",o.button_previous),button_next:(0,y.cn)((0,m.r)({variant:l}),"size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",o.button_next),month_caption:(0,y.cn)("flex items-center justify-center h-(--cell-size) w-full px-(--cell-size)",o.month_caption),dropdowns:(0,y.cn)("w-full flex items-center text-sm font-medium justify-center h-(--cell-size) gap-1.5",o.dropdowns),dropdown_root:(0,y.cn)("relative has-focus:border-ring border border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] rounded-md",o.dropdown_root),dropdown:(0,y.cn)("absolute inset-0 opacity-0",o.dropdown),caption_label:(0,y.cn)("select-none font-medium","label"===s?"text-sm":"rounded-md pl-2 pr-1 flex items-center gap-1 text-sm h-8 [&>svg]:text-muted-foreground [&>svg]:size-3.5",o.caption_label),table:"w-full border-collapse",weekdays:(0,y.cn)("flex",o.weekdays),weekday:(0,y.cn)("text-muted-foreground rounded-md flex-1 font-normal text-[0.8rem] select-none",o.weekday),week:(0,y.cn)("flex w-full mt-2",o.week),week_number_header:(0,y.cn)("select-none w-(--cell-size)",o.week_number_header),week_number:(0,y.cn)("text-[0.8rem] select-none text-muted-foreground",o.week_number),day:(0,y.cn)("relative w-full h-full p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md group/day aspect-square select-none",o.day),range_start:(0,y.cn)("rounded-l-md bg-accent",o.range_start),range_middle:(0,y.cn)("rounded-none",o.range_middle),range_end:(0,y.cn)("rounded-r-md bg-accent",o.range_end),today:(0,y.cn)("bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none",o.today),outside:(0,y.cn)("text-muted-foreground aria-selected:text-muted-foreground",o.outside),disabled:(0,y.cn)("text-muted-foreground opacity-50",o.disabled),hidden:(0,y.cn)("invisible",o.hidden),...a},components:{Root:e=>{let{className:t,rootRef:a,...r}=e;return(0,n.jsx)("div",{"data-slot":"calendar",ref:a,className:(0,y.cn)(t),...r})},Chevron:e=>{let{className:t,orientation:a,...r}=e;return"left"===a?(0,n.jsx)(B.A,{className:(0,y.cn)("size-4",t),...r}):"right"===a?(0,n.jsx)(G.A,{className:(0,y.cn)("size-4",t),...r}):(0,n.jsx)(J.A,{className:(0,y.cn)("size-4",t),...r})},DayButton:Z,WeekNumber:e=>{let{children:t,...a}=e;return(0,n.jsx)("td",{...a,children:(0,n.jsx)("div",{className:"flex size-(--cell-size) items-center justify-center text-center",children:t})})},...d},...c})}function Z(e){let{className:t,day:a,modifiers:r,...l}=e,i=(0,q.a)(),d=s.useRef(null);return s.useEffect(()=>{var e;r.focused&&(null==(e=d.current)||e.focus())},[r.focused]),(0,n.jsx)(m.$,{ref:d,variant:"ghost",size:"icon","data-day":a.date.toLocaleDateString(),"data-selected-single":r.selected&&!r.range_start&&!r.range_end&&!r.range_middle,"data-range-start":r.range_start,"data-range-end":r.range_end,"data-range-middle":r.range_middle,className:(0,y.cn)("data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 dark:hover:text-accent-foreground flex aspect-square size-auto w-full min-w-(--cell-size) flex-col gap-1 leading-none font-normal group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] data-[range-end=true]:rounded-md data-[range-end=true]:rounded-r-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md data-[range-start=true]:rounded-l-md [&>span]:text-xs [&>span]:opacity-70",i.day,t),...l})}var U=a(547);function H(e){let{...t}=e;return(0,n.jsx)(U.bL,{"data-slot":"popover",...t})}function K(e){let{...t}=e;return(0,n.jsx)(U.l9,{"data-slot":"popover-trigger",...t})}function W(e){let{className:t,align:a="center",sideOffset:r=4,...s}=e;return(0,n.jsx)(U.ZL,{children:(0,n.jsx)(U.UC,{"data-slot":"popover-content",align:a,sideOffset:r,className:(0,y.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",t),...s})})}function X(e){let{value:t="",onChange:a,placeholder:r="Chọn ng\xe0y",disabled:s=!1,className:l}=e,i=t?(0,Y.qg)(t,"yyyy-MM-dd",new Date):void 0,d=i&&(0,F.f)(i);return(0,n.jsxs)(H,{children:[(0,n.jsx)(K,{asChild:!0,children:(0,n.jsxs)(m.$,{variant:"outline",className:(0,y.cn)("w-full justify-start text-left font-normal h-10",!d&&"text-muted-foreground",l),disabled:s,children:[(0,n.jsx)(o.A,{className:"mr-2 h-4 w-4"}),d?(0,C.GP)(i,"dd/MM/yyyy",{locale:E.vi}):(0,n.jsx)("span",{children:r})]})}),(0,n.jsx)(W,{className:"w-auto p-0",align:"start",children:(0,n.jsx)(V,{mode:"single",selected:d?i:void 0,onSelect:e=>{e?a((0,C.GP)(e,"yyyy-MM-dd")):a("")},initialFocus:!0,locale:E.vi})})]})}var Q=a(9409),ee=a(9966);function et(e){let{value:t,onChange:a,disabled:r=!1,showYear:l=!0,className:i=""}=e,d=new Date().getFullYear(),[c,o]=(0,s.useState)((null==t?void 0:t.day)||1),[u,h]=(0,s.useState)((null==t?void 0:t.month)||1),[m,x]=(0,s.useState)((null==t?void 0:t.year)||d),[g,p]=(0,s.useState)((null==t?void 0:t.isLeapMonth)||!1),[y,f]=(0,s.useState)([]);(0,s.useEffect)(()=>{(async()=>{try{let e=ee.y.getLeapMonths(m);f(e),e.includes(u)||p(!1)}catch(e){console.error("Lỗi load th\xe1ng nhuận:",e),f([]),p(!1)}})()},[m,u]),(0,s.useEffect)(()=>{a({day:c,month:u,year:m,isLeapMonth:g})},[c,u,m,g]);let v=["","Gi\xeang","Hai","Ba","Tư","Năm","S\xe1u","Bảy","T\xe1m","Ch\xedn","Mười","Mười một","Chạp"];return(0,n.jsxs)("div",{className:"space-y-4 ".concat(i),children:[(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(T.J,{className:"text-sm font-medium",children:"Ng\xe0y \xe2m lịch"}),(0,n.jsxs)(Q.l6,{value:c.toString(),onValueChange:e=>o(parseInt(e)),disabled:r,children:[(0,n.jsx)(Q.bq,{children:(0,n.jsx)(Q.yv,{placeholder:"Chọn ng\xe0y"})}),(0,n.jsx)(Q.gC,{children:Array.from({length:30},(e,t)=>t+1).map(e=>(0,n.jsx)(Q.eb,{value:e.toString(),children:e},e))})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(T.J,{className:"text-sm font-medium",children:"Th\xe1ng \xe2m lịch"}),(0,n.jsxs)(Q.l6,{value:u.toString(),onValueChange:e=>h(parseInt(e)),disabled:r,children:[(0,n.jsx)(Q.bq,{children:(0,n.jsx)(Q.yv,{placeholder:"Chọn th\xe1ng"})}),(0,n.jsx)(Q.gC,{children:v.slice(1).map((e,t)=>{let a=t+1;return(0,n.jsxs)(Q.eb,{value:a.toString(),children:[e," (",a,")"]},a)})})]})]})]}),l&&(0,n.jsxs)("div",{children:[(0,n.jsx)(T.J,{className:"text-sm font-medium",children:"Năm \xe2m lịch"}),(0,n.jsx)(M.p,{type:"number",value:m,onChange:e=>x(parseInt(e.target.value)||d),disabled:r,min:d-10,max:d+10,className:"w-full"}),(0,n.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Mặc định: ",d," (năm hiện tại)"]})]}),y.includes(u)&&(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("input",{type:"checkbox",id:"leap-month",checked:g,onChange:e=>p(e.target.checked),disabled:r,className:"h-4 w-4 text-purple-600 rounded border-gray-300 focus:ring-purple-500"}),(0,n.jsxs)(T.J,{htmlFor:"leap-month",className:"text-sm",children:["Th\xe1ng ",v[u]," nhuận"]})]})]})}function ea(e){let{isLunar:t,onToggleLunar:a,solarDate:r,onSolarDateChange:l,lunarDate:i,onLunarDateChange:d,className:c,showGuidance:o=!0,showPreview:u=!0}=e,[h,m]=s.useState("");return s.useEffect(()=>{(async()=>{let e=new Date,a=[];try{if(t&&i.day&&i.month){let t="".concat(i.day,"/").concat(i.month),n=i.year?" năm ".concat(i.year):"",r=i.isLeapMonth?" (nhuận)":"";a.push("\uD83C\uDF19 Đ\xe3 chọn: ".concat(t).concat(n).concat(r));let{future:s,past:l}=((t,a,n)=>{let r,s,l=e.getFullYear(),i=null;try{i=ee.y.convertLunarToSolar(t,a,l,n)}catch(e){}return i&&i>=e?(r=i,s=ee.y.convertLunarToSolar(t,a,l-1,n)):i&&i<e?(s=i,r=ee.y.convertLunarToSolar(t,a,l+1,n)):(r=ee.y.convertLunarToSolar(t,a,l+1,n),s=ee.y.convertLunarToSolar(t,a,l-1,n)),{future:r,past:s}})(i.day,i.month,i.isLeapMonth||!1),d=(0,A.m)(s,e),c=(0,A.m)(e,l);0===d?a.push("\uD83C\uDFAF H\xf4m nay: ".concat((0,C.GP)(s,"dd/MM/yyyy"))):d>0&&a.push("\uD83D\uDCC5 Sắp đến: ".concat((0,C.GP)(s,"dd/MM/yyyy")," (").concat(d," ng\xe0y nữa)")),c>0&&a.push("⏪ Gần nhất: ".concat((0,C.GP)(l,"dd/MM/yyyy")," (").concat(c," ng\xe0y trước)"))}else if(!t&&r){let t=(0,Y.qg)(r,"yyyy-MM-dd",new Date);if((0,F.f)(t)){a.push("☀️ Đ\xe3 chọn: ".concat((0,C.GP)(t,"dd/MM/yyyy")));let n=(0,A.m)(t,e);0===n?a.push("\uD83C\uDFAF H\xf4m nay"):n>0?a.push("\uD83D\uDCC5 C\xf2n ".concat(n," ng\xe0y nữa")):a.push("⏪ Đ\xe3 qua ".concat(Math.abs(n)," ng\xe0y"));try{let e=ee.y.convertSolarToLunar(t),n=ee.y.formatLunarDate(e);a.push("\uD83C\uDF19 \xc2m lịch: ".concat(n))}catch(e){}}}}catch(e){console.error("Error calculating suggestions:",e),a.push("⚠️ Kh\xf4ng thể t\xednh to\xe1n gợi \xfd")}m(a.join("\n"))})()},[t,r,i]),(0,n.jsxs)("div",{className:(0,y.cn)("space-y-4",c),children:[(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)(T.J,{className:"text-sm font-medium",children:"Chọn loại lịch:"}),(0,n.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,n.jsx)("input",{type:"checkbox",checked:t||!1,onChange:e=>a(e.target.checked),className:"sr-only peer"}),(0,n.jsx)("div",{className:"w-11 h-6 bg-input peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-background after:border-border after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600"})]}),(0,n.jsx)("button",{type:"button",onClick:()=>a(!t),className:"flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium transition-colors ".concat(t?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"),children:t?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(z.A,{className:"h-4 w-4"}),"\xc2m lịch"]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(R.A,{className:"h-4 w-4"}),"Dương lịch"]})})]}),o&&(0,n.jsx)("div",{className:"p-3 bg-blue-50 dark:bg-blue-950 rounded-lg border-l-4 border-blue-400 dark:border-blue-600",children:(0,n.jsxs)("div",{className:"flex items-start gap-2",children:[(0,n.jsx)(b.A,{className:"h-4 w-4 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),(0,n.jsxs)("div",{className:"text-sm text-blue-800 dark:text-blue-200",children:[(0,n.jsx)("p",{className:"font-medium",children:"Chọn loại lịch để x\xe1c định ng\xe0y của sự kiện. Khuyến nghị:"}),(0,n.jsxs)("ul",{className:"list-disc list-inside text-xs mt-1",children:[(0,n.jsx)("li",{children:"Nếu sự kiện diễn ra đ\xe3 l\xe2u, sử dụng \xc2m lịch (ng\xe0y giỗ,...)."}),(0,n.jsx)("li",{children:"Nếu sự kiện diễn ra gần đ\xe2y, h\xe3y sử dụng Dương Lịch tương đương (tang, em b\xe9 vừa ch\xe0o đời,...)."}),(0,n.jsx)("li",{children:"Nếu sự kiện diễn ra v\xe0o th\xe1ng nhuận \xe2m lịch, h\xe3y sử dụng Dương Lịch tương đương."})]})]})]})})]}),(0,n.jsx)("div",{className:"space-y-2",children:t?(0,n.jsx)(et,{value:{day:i.day||1,month:i.month||1,year:i.year||new Date().getFullYear(),isLeapMonth:i.isLeapMonth||!1},onChange:d}):(0,n.jsx)(X,{value:r||"",onChange:l,placeholder:"Chọn ng\xe0y dương lịch"})}),u&&h&&(0,n.jsx)("div",{className:"bg-muted/50 p-3 rounded-md text-sm space-y-1",children:h.split("\n").map((e,t)=>(0,n.jsx)("p",{className:"text-muted-foreground",children:e},t))})]})}function en(e){let{isOpen:t,onClose:a,onBack:r,onNext:l,templateData:d}=e,[c,u]=(0,s.useState)(""),[h,x]=(0,s.useState)(""),[g,p]=(0,s.useState)(!1),[y,f]=(0,s.useState)(""),[v,j]=(0,s.useState)(""),[N,k]=(0,s.useState)(""),[w,L]=(0,s.useState)(!1),[_,A]=(0,s.useState)((0,C.GP)(new Date,"yyyy-MM-dd")),[Y,F]=(0,s.useState)(null);(0,s.useEffect)(()=>{d&&p(d.isLunar)},[d]),(0,s.useEffect)(()=>{t&&(""===_&&A((0,C.GP)(new Date,"yyyy-MM-dd")),""===y&&""===v&&""===N&&(f(1),j(1),k(new Date().getFullYear())))},[t,_,y,v,N]);let z=()=>{u(""),x(""),p(!1),f(1),j(1),k(new Date().getFullYear()),L(!1),A((0,C.GP)(new Date,"yyyy-MM-dd")),F(null)},R=()=>{z(),a()};return t?(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:R,style:{position:"fixed",top:0,left:0,right:0,bottom:0,margin:0,padding:"1rem"},children:(0,n.jsxs)(i.Zp,{className:"rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)(i.aR,{children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)(i.ZB,{className:"flex items-center gap-3 text-2xl text-blue-800 dark:text-blue-500",children:[(0,n.jsx)(o.A,{className:"h-8 w-8 text-blue-600 dark:text-blue-400"}),(0,n.jsx)("span",{children:"Th\xf4ng tin sự kiện"})]}),(0,n.jsx)("button",{onClick:R,className:"text-muted-foreground hover:text-foreground p-1 rounded-full hover:bg-accent",children:"✕"})]}),d&&(0,n.jsx)("div",{className:"mt-4 p-3 bg-green-50 dark:bg-green-950 rounded-lg border-l-4 border-green-400 dark:border-green-600",children:(0,n.jsxs)("div",{className:"flex items-start gap-2",children:[(0,n.jsx)(b.A,{className:"h-4 w-4 text-green-600 dark:text-green-400 mt-0.5 flex-shrink-0"}),(0,n.jsxs)("div",{className:"text-sm text-green-800 dark:text-green-200",children:[(0,n.jsxs)("p",{className:"font-medium",children:["Template: ",d.name]}),(0,n.jsx)("p",{className:"text-xs mt-1",children:d.description})]})]})}),(0,n.jsxs)("div",{className:"mt-4 flex items-center justify-center gap-2",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full bg-green-500"}),(0,n.jsx)("div",{className:"w-8 h-1 bg-green-500"}),(0,n.jsx)("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),(0,n.jsx)("div",{className:"w-8 h-1 bg-gray-300 dark:bg-gray-600"}),(0,n.jsx)("div",{className:"w-3 h-3 rounded-full bg-gray-300 dark:bg-gray-600"}),(0,n.jsx)("div",{className:"text-xs text-muted-foreground ml-2",children:"Bước 2/3: Th\xf4ng tin sự kiện"})]})]}),(0,n.jsx)(i.Wu,{children:(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(T.J,{htmlFor:"title",children:"Ti\xeau đề sự kiện *"}),(0,n.jsx)(M.p,{id:"title",value:c,onChange:e=>u(e.target.value),placeholder:"V\xed dụ: Giỗ \xf4ng nội",required:!0})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(T.J,{htmlFor:"description",children:"M\xf4 tả (t\xf9y chọn)"}),(0,n.jsx)("textarea",{id:"description",value:h,onChange:e=>x(e.target.value),placeholder:"Th\xeam c\xe1c chi tiết, ghi ch\xfa cho sự kiện n\xe0y...",className:"w-full min-h-[80px] border border-input bg-background rounded-md px-3 py-2 text-sm"})]}),(0,n.jsx)(ea,{isLunar:g,onToggleLunar:p,solarDate:_,onSolarDateChange:A,lunarDate:{day:"number"==typeof y?y:1,month:"number"==typeof v?v:1,year:"number"==typeof N?N:new Date().getFullYear(),isLeapMonth:w},onLunarDateChange:e=>{f(e.day||""),j(e.month||""),k(e.year||""),L(e.isLeapMonth||!1)},showGuidance:!0,showPreview:!0}),Y&&(0,n.jsx)("p",{className:"text-sm text-red-500",children:Y}),(0,n.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,n.jsxs)(m.$,{type:"button",variant:"outline",onClick:r,className:"flex-1",children:[(0,n.jsx)(S.A,{className:"h-4 w-4 mr-2"}),"Quay lại"]}),(0,n.jsxs)(m.$,{type:"button",onClick:()=>(F(null),c.trim())?!g||y&&v?g||_?void l({title:c.trim(),description:h.trim(),isLunar:g,lunarDay:y,lunarMonth:v,lunarYear:N,isLeapMonth:w,solarDate:_,repeatYearly:g}):void F("Vui l\xf2ng chọn ng\xe0y dương lịch"):void F("Vui l\xf2ng chọn đủ ng\xe0y v\xe0 th\xe1ng \xe2m lịch"):void F("Vui l\xf2ng nhập ti\xeau đề sự kiện"),className:"flex-1",children:["Tiếp theo",(0,n.jsx)(D.A,{className:"h-4 w-4 ml-2"})]})]})]})})]})}):null}var er=a(4186),es=a(4357),el=a(381),ei=a(4229),ed=a(714),ec=a(1530);function eo(e){var t;let{isOpen:a,onClose:l,onBack:d,onComplete:u,templateData:h,eventInfo:x}=e,[g,p]=(0,s.useState)([]),[y,f]=(0,s.useState)([]),[j,N]=(0,s.useState)(!1),[k,w]=(0,s.useState)(null),D=(0,r.U)();(0,s.useEffect)(()=>{(async()=>{try{let{data:{user:e}}=await D.auth.getUser();if(!e)return;let{data:t,error:a}=await D.from("notification_providers").select("id, name, is_default").eq("user_id",e.id).order("is_default",{ascending:!1});!a&&t&&f(t)}catch(e){console.error("Load providers error",e)}})()},[D]),(0,s.useEffect)(()=>{a&&h&&x&&y.length>0&&L()},[a,h,x,y]);let L=()=>{let e=y.find(e=>e.is_default),t=(null==e?void 0:e.id)||"",a=[];(null==h?void 0:h.notifySettings)&&h.notifySettings.forEach(e=>{a.push({type:x.isLunar?"lunar":"solar",advanceDays:e.advanceDays,note:e.note||"".concat(x.title),providerId:t,solarDate:x.isLunar?void 0:x.solarDate,lunarDate:x.isLunar?{day:Number(x.lunarDay),month:Number(x.lunarMonth),year:x.lunarYear?Number(x.lunarYear):new Date().getFullYear(),isLeapMonth:x.isLeapMonth}:void 0,isAutoGenerated:!0,isCustomDateEnabled:!1,isYearlyLunarRepeat:void 0!==e.isYearlyLunarRepeat?e.isYearlyLunarRepeat:x.isLunar&&x.repeatYearly})}),p(a)},_=e=>{let t=g[e];p(e=>[...e,{...t,isAutoGenerated:!1,isCustomDateEnabled:t.isCustomDateEnabled||!1,isYearlyLunarRepeat:t.isYearlyLunarRepeat||!1}])},A=e=>{p(t=>t.filter((t,a)=>a!==e))},Y=e=>{let t;if(e.isCustomDateEnabled)if("solar"===e.type)if(e.solarDate){let a={isLunar:!1,lunarDay:"",lunarMonth:"",lunarYear:"",isLeapMonth:!1,solarDate:e.solarDate};t=ee.y.calculateNotificationBaseDate(a,e.isYearlyLunarRepeat||!1)}else t=new Date;else{let a=e.lunarDate;if(a&&a.day&&a.month){let n={isLunar:!0,lunarDay:a.day,lunarMonth:a.month,lunarYear:a.year||new Date().getFullYear(),isLeapMonth:a.isLeapMonth||!1,solarDate:""};t=ee.y.calculateNotificationBaseDate(n,e.isYearlyLunarRepeat||!1)}else t=new Date}else t=ee.y.calculateNotificationBaseDate(x,e.isYearlyLunarRepeat||!1);return(0,ed.f)(t,-e.advanceDays)},F=async()=>{w(null),N(!0);let{data:{user:e}}=await D.auth.getUser();if(!e){w("Cần đăng nhập"),N(!1);return}try{let t={user_id:e.id,title:x.title,description:x.description||null,event_type:x.isLunar?"lunar":"solar"};if(x.isLunar){t.lunar_day=Number(x.lunarDay),t.lunar_month=Number(x.lunarMonth),t.lunar_year=x.lunarYear?Number(x.lunarYear):null,t.is_leap_month=x.isLeapMonth;try{t.solar_converted_date=ee.y.convertLunarToSolar(Number(x.lunarDay),Number(x.lunarMonth),x.lunarYear?Number(x.lunarYear):new Date().getFullYear(),x.isLeapMonth).toISOString().split("T")[0],t.conversion_metadata={source_lunar:{day:Number(x.lunarDay),month:Number(x.lunarMonth),is_leap_month:x.isLeapMonth},converted_for_year:new Date().getFullYear(),converted_at:new Date().toISOString(),is_valid:!0}}catch(e){console.error("Lỗi convert lunar to solar:",e)}}else t.solar_date=x.solarDate;let{data:a,error:n}=await D.from("events").insert(t).select("id").single();if(n){w(n.message),N(!1);return}for(let t of(a.id,g))if(t.providerId){let a={user_id:e.id,title:"\uD83D\uDD14 ".concat(t.note||x.title),description:"Th\xf4ng b\xe1o cho: ".concat(x.title),event_type:t.type,preferred_advance_days:0};if("solar"===t.type)a.solar_date=t.solarDate;else{let e=t.lunarDate;a.lunar_day=e.day,a.lunar_month=e.month,a.lunar_year=e.year,a.is_leap_month=e.isLeapMonth;try{a.solar_converted_date=ee.y.convertLunarToSolar(e.day,e.month,e.year,e.isLeapMonth).toISOString().split("T")[0],a.conversion_metadata={source_lunar:{day:e.day,month:e.month,is_leap_month:e.isLeapMonth},converted_for_year:new Date().getFullYear(),converted_at:new Date().toISOString(),is_valid:!0}}catch(e){console.error("Lỗi convert notification lunar to solar:",e)}}let{data:n,error:r}=await D.from("events").insert(a).select("id").single();!r&&n&&await D.from("notification_settings").insert({user_id:e.id,event_id:n.id,channel:"app",advance_days:0,provider_id:t.providerId,note:t.note||null,lunar_repeat_yearly:t.isYearlyLunarRepeat||!1})}ec.Ay.success("Đ\xe3 tạo sự kiện v\xe0 th\xf4ng b\xe1o th\xe0nh c\xf4ng!"),u()}catch(e){console.error("Error saving:",e),w("Đ\xe3 c\xf3 lỗi xảy ra khi lưu"),N(!1)}};return a?(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,n.jsxs)(i.Zp,{className:"rounded-lg shadow-xl w-full max-w-5xl max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)(i.aR,{children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)(i.ZB,{className:"flex items-center gap-3 text-2xl text-purple-800 dark:text-purple-500",children:[(0,n.jsx)(er.A,{className:"h-8 w-8 text-purple-600 dark:text-purple-400"}),(0,n.jsx)("span",{children:"C\xe0i đặt th\xf4ng b\xe1o"})]}),(0,n.jsx)("button",{onClick:l,className:"text-muted-foreground hover:text-foreground p-1 rounded-full hover:bg-accent",children:"✕"})]}),(0,n.jsxs)("div",{className:"mt-4 flex items-center justify-center gap-2",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full bg-green-500"}),(0,n.jsx)("div",{className:"w-8 h-1 bg-green-500"}),(0,n.jsx)("div",{className:"w-3 h-3 rounded-full bg-green-500"}),(0,n.jsx)("div",{className:"w-8 h-1 bg-purple-500"}),(0,n.jsx)("div",{className:"w-3 h-3 rounded-full bg-purple-500"}),(0,n.jsx)("div",{className:"text-xs text-muted-foreground ml-2",children:"Bước 3/3: C\xe0i đặt th\xf4ng b\xe1o"})]}),(0,n.jsxs)("div",{className:"mt-4 p-4 bg-muted/50 rounded-lg",children:[(0,n.jsxs)("h4",{className:"font-medium text-foreground mb-2",children:["\uD83D\uDCC5 Sự kiện: ",x.title]}),(0,n.jsxs)("div",{className:"text-sm text-muted-foreground space-y-2",children:[x.isLunar?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{children:"\uD83C\uDF19"}),(0,n.jsxs)("span",{children:["Ng\xe0y ",x.lunarDay,"/",x.lunarMonth," \xc2m lịch"," ",x.lunarYear&&"năm ".concat(x.lunarYear),x.isLeapMonth&&" (nhuận)"]})]}),(()=>{try{let e=ee.y.convertLunarToSolar(Number(x.lunarDay),Number(x.lunarMonth),x.lunarYear?Number(x.lunarYear):new Date().getFullYear(),x.isLeapMonth||!1);return(0,n.jsxs)("div",{className:"flex items-center gap-2 text-xs text-blue-600 dark:text-blue-400 ml-6",children:[(0,n.jsx)("span",{children:"↳ ☀️"}),(0,n.jsxs)("span",{children:["Tương đương: ",(0,C.GP)(e,"dd/MM/yyyy")," ","Dương lịch"]})]})}catch(e){return(0,n.jsxs)("div",{className:"flex items-center gap-2 text-xs text-orange-600 dark:text-orange-400 ml-6",children:[(0,n.jsx)("span",{children:"⚠️"}),(0,n.jsx)("span",{children:"Kh\xf4ng thể chuyển đổi sang dương lịch"})]})}})()]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{children:"☀️"}),(0,n.jsxs)("span",{children:["Ng\xe0y ",(0,C.GP)(new Date(x.solarDate),"dd/MM/yyyy")," ","Dương lịch"]})]}),(()=>{try{let e=ee.y.convertSolarToLunar(new Date(x.solarDate));return(0,n.jsxs)("div",{className:"flex items-center gap-2 text-xs text-purple-600 dark:text-purple-400 ml-6",children:[(0,n.jsx)("span",{children:"↳ \uD83C\uDF19"}),(0,n.jsxs)("span",{children:["Tương đương: ",e.day,"/",e.month," \xc2m lịch",e.isLeapMonth?" (nhuận)":""]})]})}catch(e){return(0,n.jsxs)("div",{className:"flex items-center gap-2 text-xs text-orange-600 dark:text-orange-400 ml-6",children:[(0,n.jsx)("span",{children:"⚠️"}),(0,n.jsx)("span",{children:"Kh\xf4ng thể chuyển đổi sang \xe2m lịch"})]})}})()]}),(0,n.jsx)("div",{className:"pt-1 border-t border-muted/50",children:(0,n.jsxs)("p",{children:["\uD83D\uDCE1 K\xeanh th\xf4ng b\xe1o:"," ",(null==(t=y.find(e=>e.is_default))?void 0:t.name)||"Chưa c\xf3 k\xeanh th\xf4ng b\xe1o n\xe0o"]})})]})]})]}),(0,n.jsx)(i.Wu,{children:(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsx)("div",{className:"p-3 bg-purple-50 dark:bg-purple-950 rounded-lg border-l-4 border-purple-400 dark:border-purple-600",children:(0,n.jsxs)("div",{className:"flex items-start gap-2",children:[(0,n.jsx)(b.A,{className:"h-4 w-4 text-purple-600 dark:text-purple-400 mt-0.5 flex-shrink-0"}),(0,n.jsxs)("div",{className:"text-sm text-purple-800 dark:text-purple-200",children:[(0,n.jsx)("p",{className:"font-medium",children:"Th\xf4ng b\xe1o linh hoạt"}),(0,n.jsx)("p",{className:"text-xs mt-1",children:"Mỗi th\xf4ng b\xe1o c\xf3 thể l\xe0 dương lịch (ng\xe0y cố định) hoặc \xe2m lịch (lặp h\xe0ng năm theo \xe2m lịch)."})]})]})}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("h3",{className:"font-medium text-foreground",children:"Danh s\xe1ch th\xf4ng b\xe1o sẽ được tạo"}),(0,n.jsxs)(m.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{let e=y.find(e=>e.is_default),t=new Date,a=ee.y.getTodayLunarDate();p(n=>[...n,{type:"solar",advanceDays:1,note:"",providerId:(null==e?void 0:e.id)||"",solarDate:t.toISOString().split("T")[0],lunarDate:{...a,isLeapMonth:a.isLeapMonth||!1},isAutoGenerated:!1,isCustomDateEnabled:!1,isYearlyLunarRepeat:!1}])},className:"flex items-center gap-2",children:[(0,n.jsx)(v.A,{className:"h-4 w-4"}),"Th\xeam th\xf4ng b\xe1o"]})]}),0===g.length?(0,n.jsxs)("div",{className:"text-center py-12 text-muted-foreground",children:[(0,n.jsx)(er.A,{className:"h-16 w-16 mx-auto mb-4 opacity-30"}),(0,n.jsx)("h3",{className:"text-lg font-medium mb-2",children:h?'Template "'.concat(h.name,'" kh\xf4ng c\xf3 th\xf4ng b\xe1o tự động'):"Chưa c\xf3 th\xf4ng b\xe1o n\xe0o"}),(0,n.jsx)("p",{className:"text-sm mb-4",children:h?"Bạn c\xf3 thể tự tạo th\xf4ng b\xe1o t\xf9y chỉnh cho sự kiện n\xe0y":"Bạn c\xf3 thể tạo th\xf4ng b\xe1o t\xf9y chỉnh cho sự kiện n\xe0y"}),(0,n.jsx)("div",{className:"inline-flex items-center gap-2 px-3 py-1 bg-purple-50 dark:bg-purple-950 rounded-lg text-purple-700 dark:text-purple-300 text-xs",children:'\uD83D\uDCA1 Click "Th\xeam th\xf4ng b\xe1o" để bắt đầu'})]}):g.map((e,t)=>{var a,r,s,l;let i=Y(e);return(0,n.jsxs)("div",{className:"border rounded-md p-4 bg-purple-50/30 dark:bg-purple-950/20 border-purple-200 dark:border-purple-800 relative",children:[(0,n.jsxs)("div",{className:"absolute top-2 right-2 flex gap-1",children:[(0,n.jsx)("button",{type:"button",className:"text-muted-foreground hover:text-foreground p-1 rounded hover:bg-accent",onClick:()=>_(t),title:"Nh\xe2n bản th\xf4ng b\xe1o n\xe0y",children:(0,n.jsx)(es.A,{className:"h-4 w-4"})}),(0,n.jsx)("button",{type:"button",className:"text-red-500 hover:text-red-600 dark:text-red-400 dark:hover:text-red-500 p-1 rounded hover:bg-accent",onClick:()=>A(t),title:"X\xf3a th\xf4ng b\xe1o n\xe0y",children:(0,n.jsx)(c.A,{className:"h-4 w-4"})})]}),(0,n.jsxs)("div",{className:"space-y-4 mt-6",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted/20 rounded-lg border",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(el.A,{className:"h-4 w-4 text-muted-foreground"}),(0,n.jsx)(T.J,{className:"text-sm font-medium",children:"T\xf9y chỉnh ng\xe0y th\xf4ng b\xe1o"})]}),(0,n.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,n.jsx)("input",{type:"checkbox",checked:e.isCustomDateEnabled||!1,onChange:e=>{p(a=>{let n=[...a];return n[t]={...n[t],isCustomDateEnabled:e.target.checked},n})},className:"sr-only peer"}),(0,n.jsx)("div",{className:"w-11 h-6 bg-input peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 dark:peer-focus:ring-purple-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-background after:border-border after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"})]})]}),!e.isCustomDateEnabled&&(0,n.jsxs)("p",{className:"text-xs text-muted-foreground px-3",children:["\uD83D\uDCC5 Th\xf4ng b\xe1o n\xe0y sẽ dựa v\xe0o ng\xe0y sự kiện gốc",e.advanceDays>0?" - ".concat(e.advanceDays," ng\xe0y (trước sự kiện)"):e.advanceDays<0?" + ".concat(Math.abs(e.advanceDays)," ng\xe0y (sau sự kiện)"):" (đ\xfang ng\xe0y sự kiện)"]})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between p-3 bg-red-50/30 dark:bg-red-950/20 rounded-lg border border-red-200 dark:border-red-800",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(o.A,{className:"h-4 w-4 text-red-600 dark:text-red-400"}),(0,n.jsx)(T.J,{className:"text-sm font-medium",children:"Nhắc lại h\xe0ng năm theo \xe2m lịch"})]}),(0,n.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,n.jsx)("input",{type:"checkbox",checked:e.isYearlyLunarRepeat||!1,onChange:e=>{p(a=>{let n=[...a];return n[t]={...n[t],isYearlyLunarRepeat:e.target.checked},n})},className:"sr-only peer"}),(0,n.jsx)("div",{className:"w-11 h-6 bg-input peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-red-300 dark:peer-focus:ring-red-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-background after:border-border after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600"})]})]}),e.isYearlyLunarRepeat&&(0,n.jsx)("p",{className:"text-xs text-red-600 dark:text-red-400 px-3",children:"\uD83C\uDF19 Th\xf4ng b\xe1o n\xe0y sẽ lặp lại h\xe0ng năm theo \xe2m lịch tự động. Ng\xe0y th\xf4ng b\xe1o kế tiếp sẽ được th\xeam v\xe0o th\xf4ng b\xe1o nhận được."}),!e.isYearlyLunarRepeat&&(0,n.jsx)("p",{className:"text-xs text-muted-foreground px-3",children:"\uD83D\uDCC5 Th\xf4ng b\xe1o n\xe0y chỉ diễn ra 1 lần như preview."})]}),e.isCustomDateEnabled&&(0,n.jsx)(ea,{isLunar:"lunar"===e.type,onToggleLunar:e=>{p(a=>{let n=[...a];return n[t]={...n[t],type:e?"lunar":"solar"},n})},solarDate:e.solarDate||"",onSolarDateChange:e=>{p(a=>{let n=[...a];return n[t]={...n[t],solarDate:e},n})},lunarDate:{day:(null==(a=e.lunarDate)?void 0:a.day)||1,month:(null==(r=e.lunarDate)?void 0:r.month)||1,year:(null==(s=e.lunarDate)?void 0:s.year)||new Date().getFullYear(),isLeapMonth:(null==(l=e.lunarDate)?void 0:l.isLeapMonth)||!1},onLunarDateChange:e=>{p(a=>{let n=[...a];return n[t]={...n[t],lunarDate:{day:e.day,month:e.month,year:e.year,isLeapMonth:e.isLeapMonth||!1}},n})},showGuidance:!1,showPreview:!0}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)(T.J,{className:"text-sm font-medium",children:"Nhắc trước/sau:"}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(M.p,{type:"number",value:e.advanceDays,onChange:e=>{let a=Number(e.target.value);p(e=>{let n=[...e];return n[t]={...n[t],advanceDays:a},n})},className:"w-20 h-8",placeholder:"0"}),(0,n.jsx)("span",{className:"text-sm text-muted-foreground",children:"ng\xe0y"})]})]}),(0,n.jsxs)("div",{className:"text-xs text-muted-foreground px-3 space-y-1",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{children:"\uD83D\uDCA1"}),(0,n.jsxs)("span",{children:[(0,n.jsx)("strong",{children:"Số dương (+)"}),": Nhắc trước ng\xe0y sự kiện"]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 ml-6",children:[(0,n.jsx)("span",{children:"\uD83D\uDCC5"}),(0,n.jsx)("span",{children:"V\xed dụ: +3 = nhắc trước 3 ng\xe0y"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{children:"\uD83D\uDD14"}),(0,n.jsxs)("span",{children:[(0,n.jsx)("strong",{children:"Số \xe2m (-)"}),": Nhắc sau ng\xe0y sự kiện"]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 ml-6",children:[(0,n.jsx)("span",{children:"\uD83D\uDCC5"}),(0,n.jsx)("span",{children:"V\xed dụ: -7 = nhắc sau 7 ng\xe0y (giỗ lần thứ 7)"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{children:"\uD83C\uDFAF"}),(0,n.jsxs)("span",{children:[(0,n.jsx)("strong",{children:"Số 0"}),": Nhắc đ\xfang ng\xe0y sự kiện"]})]})]})]}),(0,n.jsxs)("div",{className:"p-3 bg-muted/30 rounded-lg",children:[(0,n.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e.advanceDays>0?(0,n.jsxs)(n.Fragment,{children:["\uD83D\uDD14 Sẽ nhắc trước ",e.advanceDays," ng\xe0y v\xe0o:"," "]}):e.advanceDays<0?(0,n.jsxs)(n.Fragment,{children:["\uD83D\uDD14 Sẽ nhắc sau"," ",Math.abs(e.advanceDays)," ng\xe0y v\xe0o:"," "]}):(0,n.jsx)(n.Fragment,{children:"\uD83D\uDD14 Sẽ nhắc đ\xfang ng\xe0y sự kiện v\xe0o: "}),(0,n.jsx)("span",{className:"font-medium text-foreground",children:(0,C.GP)(i,"dd/MM/yyyy")})]}),(0,n.jsx)("div",{className:"mt-1 text-xs text-muted-foreground ml-6",children:(()=>{try{let e=ee.y.convertSolarToLunar(i);return(0,n.jsxs)("div",{className:"flex items-center gap-2 text-purple-600 dark:text-purple-400",children:[(0,n.jsx)("span",{children:"↳ \uD83C\uDF19"}),(0,n.jsxs)("span",{children:["Tương đương: ",e.day,"/",e.month," \xc2m lịch",e.isLeapMonth?" (nhuận)":""]})]})}catch(e){return(0,n.jsxs)("div",{className:"flex items-center gap-2 text-orange-600 dark:text-orange-400",children:[(0,n.jsx)("span",{children:"⚠️"}),(0,n.jsx)("span",{children:"Kh\xf4ng thể chuyển đổi sang \xe2m lịch"})]})}})()}),(0,n.jsx)("div",{className:"mt-2 text-xs text-muted-foreground space-y-1",children:e.isCustomDateEnabled?(0,n.jsxs)("p",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{children:"⚙️"}),(0,n.jsx)("span",{children:"Ng\xe0y t\xf9y chỉnh với logic tương tự"})]}):(0,n.jsx)(n.Fragment,{children:x.isLunar?e.isYearlyLunarRepeat?(0,n.jsxs)("p",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{children:"\uD83C\uDF19"}),(0,n.jsx)("span",{children:"Lặp lại h\xe0ng năm → d\xf9ng ng\xe0y \xe2m sắp đến (kh\xf4ng nhuận)"})]}):(0,n.jsxs)("p",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{children:"\uD83D\uDDD3️"}),(0,n.jsx)("span",{children:"Kh\xf4ng lặp lại → d\xf9ng ng\xe0y dương đ\xe3 convert"})]}):e.isYearlyLunarRepeat?(0,n.jsxs)("p",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{children:"\uD83D\uDD04"}),(0,n.jsx)("span",{children:"Lặp lại h\xe0ng năm → convert sang \xe2m rồi t\xednh gần nhất"})]}):(0,n.jsxs)("p",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{children:"\uD83D\uDCC5"}),(0,n.jsx)("span",{children:"Kh\xf4ng lặp lại → d\xf9ng ng\xe0y dương gốc"})]})})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(T.J,{className:"text-sm font-medium",children:"Ghi ch\xfa th\xf4ng b\xe1o:"}),(0,n.jsx)(M.p,{value:e.note,onChange:e=>{p(a=>{let n=[...a];return n[t]={...n[t],note:e.target.value},n})},placeholder:"V\xed dụ: Đừng qu\xean mua hoa, b\xe1nh chưng...",className:"mt-1"})]})]})]},t)})]}),k&&(0,n.jsx)("p",{className:"text-sm text-red-500",children:k}),(0,n.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,n.jsxs)(m.$,{type:"button",variant:"outline",onClick:d,className:"flex-1",disabled:j,children:[(0,n.jsx)(S.A,{className:"h-4 w-4 mr-2"}),"Quay lại"]}),(0,n.jsxs)(m.$,{type:"button",onClick:F,className:"flex-1",disabled:j,children:[(0,n.jsx)(ei.A,{className:"h-4 w-4 mr-2"}),j?"Đang lưu...":"Ho\xe0n th\xe0nh"]})]})]})})]})}):null}function eu(e){var t;let{isOpen:a,onClose:l,onEventCreated:o,editingEvent:u,templateData:h}=e,[x,g]=(0,s.useState)(""),[p,y]=(0,s.useState)(""),[f,j]=(0,s.useState)(!0),[N,k]=(0,s.useState)(""),[w,D]=(0,s.useState)(""),[L,_]=(0,s.useState)(""),[S,Y]=(0,s.useState)(!1),[F,z]=(0,s.useState)(!1),[R,E]=(0,s.useState)(""),[I,B]=(0,s.useState)(1),[G,J]=(0,s.useState)([]),[q,O]=(0,s.useState)(null),[P,$]=(0,s.useState)(!1),[V,Z]=(0,s.useState)([{advanceDays:0,providerId:"",note:""}]),[U,H]=(0,s.useState)([]),K=(0,r.U)(),W=!!u;(0,s.useEffect)(()=>{u&&(g(u.title),y(u.description||""),j(u.isLunar),k(u.lunarDay||""),D(u.lunarMonth||""),_(u.lunarYear||""),Y(u.isLeapMonth||!1),z(u.repeatYearly||!1),B(u.preferredAdvanceDays||1))},[u]),(0,s.useEffect)(()=>{if(a&&h&&!W){var e;let{config:t}=h;if(g(t.note||""),y(""),j(t.isLunar),z(null!=(e=t.repeatYearly)&&e),B(t.defaultAdvanceDays||1),t.setDateToToday){let e=new Date;if(t.isLunar){let t=ee.y.convertSolarToLunar(e);k(t.day),D(t.month),_(""),E("")}else E((0,C.GP)(e,"yyyy-MM-dd")),k(""),D(""),_("")}}},[a,h,W]),(0,s.useEffect)(()=>{(async()=>{try{let{data:{user:t}}=await K.auth.getUser();if(!t)return;let{data:a,error:n}=await K.from("notification_providers").select("id, name, is_default").eq("user_id",t.id).order("is_default",{ascending:!1});if(!n&&a){H(a);let t=a.find(e=>e.is_default),n=(null==t?void 0:t.id)||"";if(h&&!W){var e;let t=(null==(e=h.notifySettings)?void 0:e.map(e=>({advanceDays:e.advanceDays,note:e.note||"",providerId:n})))||[];Z(t.length>0?t:[{advanceDays:0,providerId:n,note:""}])}else W||1!==V.length||V[0].providerId||Z([{...V[0],providerId:n}])}}catch(e){console.error("Load providers error",e)}})()},[K,h,W]);let X=()=>{g(""),y(""),j(!0),k(""),D(""),_(""),Y(!1),z(!1),E(""),B(1),J([]),O(null),$(!1),Z([{advanceDays:0,providerId:"",note:""}])};(0,s.useEffect)(()=>{let e=new Date;try{if(f){if(!N||!w)return void J([]);let{future:t,past:a}=((t,a,n)=>{let r,s,l,i=e.getFullYear();try{r=ee.y.convertLunarToSolar(t,a,i,n)}catch(e){r=new Date(NaN)}return!isNaN(r.getTime())&&r>=e?(s=r,l=ee.y.convertLunarToSolar(t,a,i-1,n)):!isNaN(r.getTime())&&r<e?(l=r,s=ee.y.convertLunarToSolar(t,a,i+1,n)):(s=ee.y.convertLunarToSolar(t,a,i+1,n),l=ee.y.convertLunarToSolar(t,a,i-1,n)),{future:s,past:l}})(Number(N),Number(w),S),n=(0,A.m)(t,e),r=(0,A.m)(e,a);J(["Ng\xe0y DL sắp đến: ".concat((0,C.GP)(t,"dd/MM/yyyy")," (c\xf2n ").concat(n," ng\xe0y)"),"Ng\xe0y DL đ\xe3 qua gần nhất: ".concat((0,C.GP)(a,"dd/MM/yyyy")," (c\xe1ch đ\xe2y ").concat(r," ng\xe0y)")])}else{if(!R)return void J([]);let t=new Date(R),a=ee.y.convertSolarToLunar(t),n=ee.y.getLunarDetailInfo(t),r=(null==n?void 0:n.yearName)||"",s=(0,A.m)(t,e),l=s>0?"sắp đến, c\xf2n ".concat(s," ng\xe0y"):s<0?"đ\xe3 qua, c\xe1ch hiện tại ".concat(Math.abs(s)," ng\xe0y"):"h\xf4m nay";J(["Ng\xe0y \xc2L chuyển đổi: ".concat(a.day,"/").concat(a.month," năm ").concat(a.year," (").concat(r,") (").concat(l,")")])}}catch(e){J([])}},[f,N,w,S,R]),(0,s.useMemo)(()=>{if(!L)return null;let e=new Date().getFullYear()-Number(L);return e>=0?e:null},[L]);let Q=async e=>{if(e.preventDefault(),O(null),$(!0),!x){O("Vui l\xf2ng nhập ti\xeau đề sự kiện"),$(!1);return}if(f&&(!N||!w)){O("Vui l\xf2ng chọn đủ ng\xe0y v\xe0 th\xe1ng \xe2m lịch"),$(!1);return}if(!f&&!R){O("Vui l\xf2ng chọn ng\xe0y dương lịch"),$(!1);return}let{data:{user:t}}=await K.auth.getUser();if(!t){O("Cần đăng nhập"),$(!1);return}let a={user_id:t.id,title:x,description:p||null,is_lunar:f,is_leap_month:S,lunar_repeat_yearly:F,preferred_advance_days:I};f?(a.lunar_day=Number(N),a.lunar_month=Number(w),a.lunar_year=L?Number(L):null):a.solar_date=R;try{let e;if(W&&u){let{error:n}=await K.from("events").update(a).eq("id",u.id).eq("user_id",t.id);e=n}else{let{error:t}=await K.from("events").insert(a);e=t}if(e)O(e.message),$(!1);else{var n;let e=null==(n=(W?{data:[u],error:null}:await K.from("events").select("id").order("created_at",{ascending:!1}).limit(1).single()).data)?void 0:n.id;if(e)for(let a of(W&&await K.from("notification_settings").delete().eq("event_id",e),V))a.providerId&&await K.from("notification_settings").insert({user_id:t.id,event_id:e,advance_days:a.advanceDays,provider_id:a.providerId,note:a.note||null});X(),l(),null==o||o()}}catch(e){O("Đ\xe3 c\xf3 lỗi xảy ra"),$(!1)}},et=(0,s.useMemo)(()=>Array.from({length:30},(e,t)=>t+1),[]),ea=(0,s.useMemo)(()=>Array.from({length:12},(e,t)=>t+1),[]),en=()=>{X(),l()};return a?(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:en,style:{position:"fixed",top:0,left:0,right:0,bottom:0,margin:0,padding:"1rem"},children:(0,n.jsxs)(i.Zp,{className:"rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)(i.aR,{children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)(i.ZB,{className:"flex items-center gap-3 text-2xl text-red-800 dark:text-red-500",children:W?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(d.A,{className:"h-8 w-8 text-amber-600 dark:text-amber-400"}),(0,n.jsx)("span",{children:"Chỉnh sửa sự kiện"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(v.A,{className:"h-8 w-8 text-red-600 dark:text-red-400"}),(0,n.jsx)("span",{children:"Tạo sự kiện mới"})]})}),(0,n.jsx)("button",{onClick:en,className:"text-muted-foreground hover:text-foreground p-1 rounded-full hover:bg-accent",children:"✕"})]}),(0,n.jsx)("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-950 rounded-lg border-l-4 border-blue-400 dark:border-blue-600",children:(0,n.jsxs)("div",{className:"flex items-start gap-2",children:[(0,n.jsx)(b.A,{className:"h-4 w-4 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),(0,n.jsxs)("div",{className:"text-sm text-blue-800 dark:text-blue-200",children:[(0,n.jsx)("p",{className:"font-medium mb-1",children:"Lưu \xfd:"}),(0,n.jsx)("ul",{className:"space-y-1 text-xs",children:(0,n.jsxs)("li",{children:["• ",(0,n.jsx)("strong",{children:"Năm \xc2m:"})," d\xf9ng để nhắc số năm đ\xe3 qua khi nhận nhắc nhở (t\xf9y chọn)"]})})]})]})})]}),(0,n.jsx)(i.Wu,{children:(0,n.jsxs)("form",{onSubmit:Q,className:"space-y-6",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(T.J,{htmlFor:"title",children:"Ti\xeau đề"}),(0,n.jsx)(M.p,{id:"title",value:x,onChange:e=>g(e.target.value),placeholder:"V\xed dụ: Giỗ \xf4ng nội",required:!0})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(T.J,{htmlFor:"description",children:"M\xf4 tả (t\xf9y chọn)"}),(0,n.jsx)("textarea",{id:"description",value:p,onChange:e=>y(e.target.value),placeholder:"Th\xeam c\xe1c chi tiết, ghi ch\xfa cho sự kiện n\xe0y...",className:"w-full min-h-[80px] border border-input bg-background rounded-md px-3 py-2 text-sm"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,n.jsx)("input",{type:"checkbox",checked:!f,onChange:e=>j(!e.target.checked),className:"sr-only peer"}),(0,n.jsx)("div",{className:"w-11 h-6 bg-input peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-background after:border-border after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]}),(0,n.jsx)("span",{className:"text-sm font-medium ".concat(f?"text-red-600 dark:text-red-400":"hidden"),children:"\xc2m lịch"}),(0,n.jsx)("span",{className:"text-sm font-medium ".concat(f?"hidden":"text-blue-600 dark:text-blue-400"),children:"Dương lịch"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,n.jsx)("input",{type:"checkbox",checked:F,onChange:e=>z(e.target.checked),className:"sr-only peer"}),(0,n.jsx)("div",{className:"w-11 h-6 bg-input peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 dark:peer-focus:ring-green-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-background after:border-border after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"})]}),(0,n.jsx)("span",{className:"text-sm font-medium ".concat(F?"hidden":"text-orange-600 dark:text-orange-400"),children:"Kh\xf4ng nhắc lại h\xe0ng năm (th\xf4i n\xf4i, đầy th\xe1ng)"}),(0,n.jsx)("span",{className:"text-sm font-medium ".concat(F?"text-green-600 dark:text-green-400":"hidden"),children:"Nhắc lại h\xe0ng năm (ng\xe0y giỗ,...)"})]}),f?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(T.J,{children:"Ng\xe0y \xc2m"}),(0,n.jsxs)("select",{className:"w-full border border-input bg-background rounded-md px-3 py-2 text-sm h-10",value:N,onChange:e=>k(Number(e.target.value)),children:[(0,n.jsx)("option",{value:"",children:"Chọn"}),et.map(e=>(0,n.jsx)("option",{value:e,children:e},e))]})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(T.J,{children:"Th\xe1ng \xc2m"}),(0,n.jsxs)("select",{className:"w-full border border-input bg-background rounded-md px-3 py-2 text-sm h-10",value:w,onChange:e=>D(Number(e.target.value)),children:[(0,n.jsx)("option",{value:"",children:"Chọn"}),ea.map(e=>(0,n.jsx)("option",{value:e,children:e},e))]})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(T.J,{children:"Năm \xc2m"}),(0,n.jsx)(M.p,{type:"number",placeholder:"Tuỳ chọn",value:L,onChange:e=>_(e.target.value?Number(e.target.value):""),className:"h-10"})]})]})}):(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(T.J,{children:"Ng\xe0y dương"}),(0,n.jsx)(M.p,{type:"date",value:R,onChange:e=>E(e.target.value)})]}),G.length>0&&(0,n.jsx)("div",{className:"bg-muted p-4 rounded-md space-y-1 text-sm text-muted-foreground",children:G.map((e,t)=>(0,n.jsx)("p",{children:e},t))}),(0,n.jsx)("hr",{className:"my-4"}),(0,n.jsxs)("h3",{className:"font-medium text-foreground flex items-center gap-2",children:[(0,n.jsx)("span",{children:"\uD83D\uDD14"})," Th\xf4ng b\xe1o cơ bản"]}),U.find(e=>e.is_default)&&(0,n.jsxs)("p",{className:"text-sm text-muted-foreground mb-3",children:["Sẽ gửi th\xf4ng b\xe1o qua k\xeanh mặc định:"," ",(0,n.jsx)("span",{className:"font-medium text-blue-600 dark:text-blue-400",children:null==(t=U.find(e=>e.is_default))?void 0:t.name})]}),(0,n.jsx)("div",{className:"grid grid-cols-1 gap-4 p-4 border border-input rounded-md bg-muted/30",children:(0,n.jsxs)("div",{children:[(0,n.jsx)(T.J,{htmlFor:"preferredAdvanceDays",children:"Nhắc trước (ng\xe0y)"}),(0,n.jsx)(M.p,{id:"preferredAdvanceDays",type:"number",min:"0",value:I,onChange:e=>B(Number(e.target.value)),placeholder:"1",className:"mt-1"}),(0,n.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Th\xf4ng b\xe1o ch\xednh sẽ được gửi trước sự kiện số ng\xe0y n\xe0y"})]})}),(0,n.jsxs)("details",{className:"mt-4",children:[(0,n.jsxs)("summary",{className:"font-medium text-foreground flex items-center gap-2 cursor-pointer hover:text-primary",children:[(0,n.jsx)("span",{children:"⚙️"})," C\xe0i đặt n\xe2ng cao (t\xf9y chọn)"]}),(0,n.jsx)("div",{className:"mt-4 space-y-4",children:V.map((e,t)=>(0,n.jsxs)("div",{className:"border border-input rounded-md p-4 relative space-y-4",children:[(0,n.jsxs)("div",{className:"absolute top-2 right-2 flex gap-1",children:[(0,n.jsx)("button",{type:"button",className:"text-muted-foreground hover:text-foreground",onClick:()=>Z(t=>[...t,{...e}]),title:"Nh\xe2n bản",children:(0,n.jsx)(es.A,{className:"h-4 w-4"})}),t===V.length-1&&(0,n.jsx)("button",{type:"button",className:"text-green-500 hover:text-green-600 dark:text-green-400 dark:hover:text-green-500",onClick:()=>{let e=U.find(e=>e.is_default);Z(t=>[...t,{advanceDays:0,providerId:(null==e?void 0:e.id)||"",note:""}])},title:"Th\xeam nhắc",children:(0,n.jsx)(v.A,{className:"h-4 w-4"})}),V.length>1&&(0,n.jsx)("button",{type:"button",className:"text-red-500 hover:text-red-600 dark:text-red-400 dark:hover:text-red-500",onClick:()=>Z(e=>e.filter((e,a)=>a!==t)),title:"X\xf3a",children:(0,n.jsx)(c.A,{className:"h-4 w-4"})})]}),(0,n.jsxs)("div",{className:"grid gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(T.J,{children:"Nhắc trước (ng\xe0y)"}),(0,n.jsx)(M.p,{type:"number",min:"0",value:e.advanceDays,onChange:e=>{let a=Number(e.target.value);Z(e=>{let n=[...e];return n[t].advanceDays=a,n})},className:"mt-1"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(T.J,{children:"Ghi ch\xfa khi gửi"}),(0,n.jsx)(M.p,{value:e.note,onChange:e=>{let a=e.target.value;Z(e=>{let n=[...e];return n[t].note=a,n})},placeholder:"V\xed dụ: Đừng qu\xean mua hoa",className:"mt-1"})]})]})]},t))})]}),q&&(0,n.jsx)("p",{className:"text-sm text-red-500",children:q}),(0,n.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,n.jsx)(m.$,{type:"button",variant:"outline",onClick:en,className:"flex-1",disabled:P,children:"Hủy"}),(0,n.jsx)(m.$,{type:"submit",className:"flex-1 ".concat(W?"bg-amber-600 text-primary-foreground hover:bg-amber-700":"bg-red-600 text-destructive-foreground hover:bg-red-700"),disabled:P,children:W?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(d.A,{className:"h-4 w-4 mr-2"}),P?"Đang cập nhật...":"Cập nhật sự kiện"]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ei.A,{className:"h-4 w-4 mr-2"}),P?"Đang lưu...":"Lưu sự kiện"]})})]})]})})]})}):null}let eh="force-dynamic";function em(){let[e,t]=(0,s.useState)([]),[a,i]=(0,s.useState)(!0),[d,c]=(0,s.useState)(!1),[u,h]=(0,s.useState)(!1),[x,g]=(0,s.useState)(!1),[p,y]=(0,s.useState)(!1),[j,N]=(0,s.useState)(!1),[k,w]=(0,s.useState)(null),[D,L]=(0,s.useState)(null),[C,S]=(0,s.useState)(null),[M,T]=(0,s.useState)(null),[A,Y]=(0,s.useState)(!1),[F,z]=(0,s.useState)(null),R=(0,r.U)(),E=(0,l.useRouter)(),I=async e=>{try{let{data:t,error:a}=await R.from("events").select("*, notification_settings(*)").eq("user_id",e).order("lunar_month",{ascending:!0}).order("lunar_day",{ascending:!0});if(a)return console.error("Error fetching events:",a),[];return t.map(e=>({id:e.id,title:e.title,description:e.description,isLunar:e.is_lunar,isLeapMonth:e.is_leap_month,lunarDay:e.lunar_day,lunarMonth:e.lunar_month,lunarYear:e.lunar_year,repeatYearly:e.lunar_repeat_yearly,solarDate:e.solar_date,preferredAdvanceDays:e.preferred_advance_days,notification_settings:e.notification_settings}))}catch(e){return console.error("Error:",e),[]}};(0,s.useEffect)(()=>{(async()=>{try{let{data:{session:e}}=await R.auth.getSession();if(!e)return void E.push("/");z(e.user);let a=await I(e.user.id);t(a)}catch(e){console.error("Error checking auth:",e)}finally{i(!1)}})()},[R,E]);let B=async()=>{F&&(ec.Ay.success(C?"Cập nhật sự kiện th\xe0nh c\xf4ng!":"Đ\xe3 tạo sự kiện mới!"),t(await I(F.id)))},G=()=>{console.log("DEBUG: EventsPage -> handleOpenCreateFlow called"),c(!0)},J=()=>{S(null),y(!1)},q=()=>{T(null),N(!1)},O=async()=>{if(M&&F){Y(!0);try{let{error:e}=await R.from("events").delete().eq("id",M.id).eq("user_id",F.id);e?(console.error("Lỗi x\xf3a event:",e),ec.Ay.error("Kh\xf4ng thể x\xf3a sự kiện: "+e.message)):(ec.Ay.success("Đ\xe3 x\xf3a sự kiện th\xe0nh c\xf4ng!"),q(),B())}catch(e){console.error("Lỗi x\xf3a event:",e),ec.Ay.error("Đ\xe3 c\xf3 lỗi xảy ra khi x\xf3a sự kiện")}finally{Y(!1)}}};return a?(0,n.jsxs)("div",{className:"space-y-8",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)(o.A,{className:"h-8 w-8 text-primary"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-foreground",children:"Tất cả Sự kiện"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:"Đang tải..."})]})]}),(0,n.jsx)("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(e=>(0,n.jsx)("div",{className:"h-20 bg-muted rounded-lg"},e))})]}):(0,n.jsxs)("div",{className:"space-y-8",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)(o.A,{className:"h-8 w-8 text-primary"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-foreground",children:"Tất cả Sự kiện"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:"Quản l\xfd c\xe1c sự kiện v\xe0 lời nhắc của bạn"})]})]}),(0,n.jsxs)(m.$,{onClick:G,children:[(0,n.jsx)(v.A,{className:"h-4 w-4 mr-2"}),"Tạo sự kiện mới"]})]}),e.length>0?(0,n.jsx)("div",{className:"space-y-4",children:(0,n.jsx)(f,{events:e,onEdit:e=>{S(e),y(!0)},onDelete:e=>{T(e),N(!0)}})}):(0,n.jsxs)("div",{className:"text-center py-16 space-y-6",children:[(0,n.jsx)("div",{className:"bg-muted rounded-full w-24 h-24 flex items-center justify-center mx-auto",children:(0,n.jsx)(b.A,{className:"h-12 w-12 text-muted-foreground"})}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold text-foreground",children:"Chưa c\xf3 sự kiện n\xe0o"}),(0,n.jsx)("p",{className:"text-muted-foreground max-w-md mx-auto",children:"H\xe3y bắt đầu bằng c\xe1ch tạo sự kiện đầu ti\xean của bạn. Bạn c\xf3 thể tạo lời nhắc cho ng\xe0y giỗ, sinh nhật, kỷ niệm theo lịch \xe2m."})]}),(0,n.jsxs)(m.$,{onClick:G,children:[(0,n.jsx)(v.A,{className:"h-4 w-4 mr-2"}),"Tạo sự kiện đầu ti\xean"]})]}),(0,n.jsx)(_,{isOpen:d,onClose:()=>c(!1),onSelect:e=>{w(e),c(!1),h(!0)}}),(0,n.jsx)(en,{isOpen:u,onClose:()=>h(!1),onBack:()=>{h(!1),c(!0)},onNext:e=>{L(e),h(!1),g(!0)},templateData:k}),D&&(0,n.jsx)(eo,{isOpen:x,onClose:()=>g(!1),onBack:()=>{g(!1),h(!0)},onComplete:()=>{g(!1),w(null),L(null),B()},templateData:k,eventInfo:D}),C&&(0,n.jsx)(eu,{isOpen:p,onClose:J,onEventCreated:()=>{J(),B()},editingEvent:C}),j&&M&&(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60",children:(0,n.jsxs)("div",{className:"bg-card p-6 rounded-lg shadow-xl max-w-sm w-full",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"X\xe1c nhận x\xf3a"}),(0,n.jsxs)("p",{className:"text-sm text-muted-foreground mt-2",children:["Bạn c\xf3 chắc chắn muốn x\xf3a sự kiện"," ",(0,n.jsxs)("strong",{children:['"',M.title,'"']}),"? H\xe0nh động n\xe0y kh\xf4ng thể ho\xe0n t\xe1c."]}),(0,n.jsxs)("div",{className:"mt-6 flex justify-end gap-3",children:[(0,n.jsx)(m.$,{variant:"ghost",onClick:q,children:"Hủy"}),(0,n.jsx)(m.$,{variant:"destructive",onClick:O,disabled:A,children:A?"Đang x\xf3a...":"X\xf3a"})]})]})})]})}},6695:(e,t,a)=>{"use strict";a.d(t,{BT:()=>d,Wu:()=>c,ZB:()=>i,Zp:()=>s,aR:()=>l});var n=a(5155);a(2115);var r=a(9434);function s(e){let{className:t,...a}=e;return(0,n.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...a})}function l(e){let{className:t,...a}=e;return(0,n.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...a})}function i(e){let{className:t,...a}=e;return(0,n.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-semibold",t),...a})}function d(e){let{className:t,...a}=e;return(0,n.jsx)("div",{"data-slot":"card-description",className:(0,r.cn)("text-muted-foreground text-sm",t),...a})}function c(e){let{className:t,...a}=e;return(0,n.jsx)("div",{"data-slot":"card-content",className:(0,r.cn)("px-6",t),...a})}},9409:(e,t,a)=>{"use strict";a.d(t,{bq:()=>u,eb:()=>m,gC:()=>h,l6:()=>c,yv:()=>o});var n=a(5155),r=a(2115),s=a(8893),l=a(6474),i=a(5196),d=a(9434);let c=s.bL;s.YJ;let o=s.WT,u=r.forwardRef((e,t)=>{let{className:a,children:r,...i}=e;return(0,n.jsxs)(s.l9,{ref:t,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),...i,children:[r,(0,n.jsx)(s.In,{asChild:!0,children:(0,n.jsx)(l.A,{className:"h-4 w-4 opacity-50"})})]})});u.displayName=s.l9.displayName;let h=r.forwardRef((e,t)=>{let{className:a,children:r,position:l="popper",...i}=e;return(0,n.jsx)(s.ZL,{children:(0,n.jsx)(s.UC,{ref:t,className:(0,d.cn)("relative z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:l,...i,children:(0,n.jsx)(s.LM,{className:(0,d.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r})})})});h.displayName=s.UC.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(s.JU,{ref:t,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...r})}).displayName=s.JU.displayName;let m=r.forwardRef((e,t)=>{let{className:a,children:r,...l}=e;return(0,n.jsxs)(s.q7,{ref:t,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...l,children:[(0,n.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(s.VF,{children:(0,n.jsx)(i.A,{className:"h-4 w-4"})})}),(0,n.jsx)(s.p4,{children:r})]})});m.displayName=s.q7.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(s.wv,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",a),...r})}).displayName=s.wv.displayName},9434:(e,t,a)=>{"use strict";a.d(t,{cn:()=>s});var n=a(2596),r=a(9688);function s(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.QP)((0,n.$)(t))}},9966:(e,t,a)=>{"use strict";a.d(t,{y:()=>r});var n=a(1869);class r{static getTodayLunarDate(){let e=new Date;return this.convertSolarToLunar(e)}static convertSolarToLunar(e){try{let t=new n.SolarDate(e).toLunarDate().get();return{day:t.day,month:t.month,year:t.year,isLeapMonth:t.leap_month||!1,isLeapYear:t.leap_year||!1}}catch(a){console.error("Lỗi chuyển đổi dương lịch sang \xe2m lịch:",a);let t=e.getDate();return{day:Math.max(1,Math.min(30,t)),month:e.getMonth()+1,year:e.getFullYear()-621,isLeapMonth:!1,isLeapYear:!1}}}static convertLunarToSolar(e,t,a){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];try{let s=new n.LunarDate({day:e,month:t,year:a,leap_month:r});s.init();let l=s.toSolarDate().get();return new Date(l.year,l.month-1,l.day)}catch(n){return console.error("Lỗi chuyển đổi \xe2m lịch sang dương lịch:",n),new Date(a+621,t-1,e)}}static getNextLunarOccurrence(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Date,r=n.getFullYear();try{let s=this.convertLunarToSolar(e,t,r,a);if(s>=n)return s;return this.convertLunarToSolar(e,t,r+1,a)}catch(s){try{return this.convertLunarToSolar(e,t,r+1,a)}catch(l){return console.error("Kh\xf4ng thể t\xednh ng\xe0y \xe2m lịch sắp tới:",{lunarDay:e,lunarMonth:t,isLeapMonth:a,currentYear:r,error:s,nextYearError:l}),n}}}static calculateNotificationBaseDate(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date;if(e.isLunar){let n=Number(e.lunarDay),r=Number(e.lunarMonth),s=e.lunarYear?Number(e.lunarYear):a.getFullYear();if(t)return this.getNextLunarOccurrence(n,r,!1,a);try{return this.convertLunarToSolar(n,r,s,e.isLeapMonth)}catch(e){return console.error("Error converting lunar to solar (case 1):",e),a}}{let n=new Date(e.solarDate);if(!t)return n;try{let e=this.convertSolarToLunar(n);return this.getNextLunarOccurrence(e.day,e.month,!1,a)}catch(e){return console.error("Error converting solar to lunar (case 4):",e),n}}}static shouldShowReminderToday(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.getTodayLunarDate();return n.day===e&&n.month===t&&n.isLeapMonth===a}static formatLunarDate(e){let t=e.isLeapMonth?" (nhuận)":"";return"".concat(e.day,"/").concat(e.month,"/").concat(e.year).concat(t)}static getLunarDateText(e){let t=e.isLeapMonth?" nhuận":"";return"Ng\xe0y ".concat(e.day," th\xe1ng ").concat(["","Gi\xeang","Hai","Ba","Tư","Năm","S\xe1u","Bảy","T\xe1m","Ch\xedn","Mười","Mười một","Chạp"][e.month]).concat(t," năm ").concat(e.year)}static getLunarDetailInfo(e){try{let t=new n.SolarDate(e).toLunarDate(),a=t.get();return{lunarDate:{day:a.day,month:a.month,year:a.year,isLeapMonth:a.leap_month||!1,isLeapYear:a.leap_year||!1},yearName:t.getYearName(),monthName:t.getMonthName(),dayName:t.getDayName(),hourName:t.getHourName(),dayOfWeek:t.getDayOfWeek(),solarTerm:t.getSolarTerm(),luckyHours:t.getLuckyHours()}}catch(e){return console.error("Lỗi lấy th\xf4ng tin chi tiết \xe2m lịch:",e),null}}static isLeapYear(e){try{let t=new n.LunarDate({day:1,month:1,year:e});return t.init(),t.get().leap_year||!1}catch(e){return console.error("Lỗi kiểm tra năm nhuận:",e),!1}}static getLeapMonths(e){let t=[];try{let a=new Set;for(let t=1;t<=12;t++)for(let r=1;r<=28;r+=7)try{let s=new Date(e,t-1,r),l=new n.SolarDate(s).toLunarDate().get();l.year===e&&l.leap_month&&a.add(l.month)}catch(e){continue}t.push(...Array.from(a).sort((e,t)=>e-t))}catch(e){console.error("Lỗi lấy th\xe1ng nhuận:",e)}return t}}}},e=>{var t=t=>e(e.s=t);e.O(0,[455,865,512,779,530,563,911,441,684,358],()=>t(310)),_N_E=e.O()}]);